@using ClivoxApp.Models.Invoice

<MudDialog MaxWidth="MaxWidth.Large" FullWidth="true">
    <TitleContent>
        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
            <MudIcon Icon="@GetFileIcon()" />
            <MudText Typo="Typo.h6">@File.FileName</MudText>
            <MudSpacer />
            <MudIconButton Icon="@Icons.Material.Filled.Download" 
                          OnClick="DownloadFile" 
                          Title="Download File" />
        </MudStack>
    </TitleContent>
    <DialogContent>
        <div style="max-height: 80vh; overflow: auto;">
            @if (IsImage())
            {
                <div style="text-align: center; padding: 20px;">
                    <img src="@GetImageSource()" 
                         alt="@File.FileName" 
                         style="max-width: 100%; max-height: 70vh; object-fit: contain; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);" />
                </div>
            }
            else if (IsPdf())
            {
                <div style="width: 100%; height: 70vh;">
                    <iframe src="@GetPdfSource()" 
                            style="width: 100%; height: 100%; border: none; border-radius: 8px;"
                            title="@File.FileName">
                        <p>Your browser does not support PDFs. <a href="@GetPdfSource()" target="_blank">Download the PDF</a>.</p>
                    </iframe>
                </div>
            }
            else
            {
                <MudAlert Severity="Severity.Warning">
                    <MudText>This file type cannot be previewed. You can download it to view.</MudText>
                </MudAlert>
            }
        </div>
        
        @if (!string.IsNullOrEmpty(File.Description) || File.Amount > 0)
        {
            <MudDivider Class="my-4" />
            <MudPaper Class="pa-4" Elevation="1">
                <MudText Typo="Typo.subtitle2" Class="mb-2">File Details</MudText>
                @if (!string.IsNullOrEmpty(File.Description))
                {
                    <MudStack Row="true" AlignItems="AlignItems.Start" Spacing="2" Class="mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.Description" Size="Size.Small" Color="Color.Primary" />
                        <MudText Typo="Typo.body2">@File.Description</MudText>
                    </MudStack>
                }
                @if (File.Amount > 0)
                {
                    <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                        <MudIcon Icon="@Icons.Material.Filled.Euro" Size="Size.Small" Color="Color.Success" />
                        <MudText Typo="Typo.body2">€@File.Amount.ToString("F2")</MudText>
                    </MudStack>
                }
            </MudPaper>
        }
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Close" Color="Color.Primary">Close</MudButton>
    </DialogActions>
</MudDialog>